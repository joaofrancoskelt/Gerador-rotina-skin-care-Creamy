<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creamy | Sua Rotina Ideal</title>
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/11130/11130152.png">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <style>
        /* --- 1. VARI√ÅVEIS & RESET --- */
        :root {
            /* Cores da Marca e UI */
            --primary: #E91E63;
            --primary-hover: #C2185B;
            --primary-light: #FCE4EC;
            --secondary: #2D3436;
            --text-body: #4A5568;
            --bg-body: #F7F9FC;
            --white: #FFFFFF;
            --border: #E2E8F0;
            --success: #48BB78;

            /* Cores de Categoria */
            --cat-limpeza: #00BCD4;
            --cat-tonico: #673AB7;
            --cat-antiox: #FF9800;
            --cat-acido: #E91E63;
            --cat-hidra: #2196F3;
            --cat-fps: #FFC107;

            /* Efeitos */
            --radius: 16px;
            --shadow-sm: 0 4px 6px rgba(0,0,0,0.02);
            --shadow-md: 0 10px 30px rgba(0,0,0,0.08);
            --shadow-hover: 0 20px 40px rgba(233, 30, 99, 0.15);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-font-smoothing: antialiased; }
        
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--bg-body); 
            color: var(--secondary); 
            line-height: 1.6; 
            padding-bottom: 80px;
        }

        /* --- 2. COMPONENTES GERAIS --- */
        .container { max-width: 800px; margin: 0 auto; padding: 0 20px; }
        
        /* Barra de Progresso Fixa no Topo */
        .progress-container {
            position: sticky;
            top: 0;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            z-index: 100;
            padding: 15px 0;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }
        .progress-bar {
            height: 6px;
            background: #EDF2F7;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 5px;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), #FF4081);
            width: 0%;
            transition: width 0.5s ease;
        }
        .progress-text { font-size: 0.8rem; font-weight: 600; color: var(--primary); text-transform: uppercase; letter-spacing: 1px; display: flex; justify-content: space-between; }

        /* Header */
        header { text-align: center; padding: 40px 0 20px; }
        .brand { color: var(--primary); font-size: 3rem; font-weight: 800; letter-spacing: -2px; display: inline-block; margin-bottom: 5px; }
        .subtitle { color: var(--text-body); font-size: 1.1rem; max-width: 500px; margin: 0 auto; }

        /* --- 3. SE√á√ïES DE PERGUNTA (CARDS) --- */
        .question-section {
            background: var(--white);
            border-radius: var(--radius);
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border);
            opacity: 0; 
            transform: translateY(20px);
            animation: fadeUp 0.6s ease forwards;
        }
        
        .section-header { margin-bottom: 25px; display: flex; align-items: center; gap: 12px; }
        .section-icon { width: 40px; height: 40px; background: var(--primary-light); color: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; }
        .section-title { font-size: 1.25rem; font-weight: 700; color: var(--secondary); }

        /* Grid de Op√ß√µes */
        .options-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; }
        .option-input { display: none; }
        
        .option-card {
            background: var(--white);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 25px 15px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .option-card:hover { transform: translateY(-5px); box-shadow: var(--shadow-md); border-color: #FECFE0; }
        .option-icon { font-size: 2.5rem; color: #A0AEC0; margin-bottom: 15px; transition: var(--transition); }
        .option-label { font-weight: 600; font-size: 1rem; color: var(--text-body); transition: var(--transition); }

        /* Estados Ativos */
        .option-input:checked + .option-card {
            border-color: var(--primary);
            background: linear-gradient(to bottom right, #FFF5F8, #FFFFFF);
            box-shadow: 0 0 0 4px rgba(233, 30, 99, 0.1);
        }
        .option-input:checked + .option-card .option-icon { color: var(--primary); transform: scale(1.1); }
        .option-input:checked + .option-card .option-label { color: var(--primary); }
        .check-badge { position: absolute; top: 10px; right: 10px; color: var(--primary); opacity: 0; transform: scale(0); transition: var(--transition); }
        .option-input:checked + .option-card .check-badge { opacity: 1; transform: scale(1); }

        /* --- 4. BOT√ÉO GERAR --- */
        .action-area { text-align: center; margin: 50px 0; }
        .btn-generate {
            background: linear-gradient(135deg, var(--primary), #FF4081);
            color: white;
            padding: 20px 60px;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: 700;
            border: none;
            cursor: pointer;
            box-shadow: var(--shadow-hover);
            transition: var(--transition);
            letter-spacing: 0.5px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        .btn-generate:hover:not(:disabled) { transform: translateY(-3px) scale(1.02); box-shadow: 0 25px 50px rgba(233, 30, 99, 0.3); }
        .btn-generate:active:not(:disabled) { transform: scale(0.98); }
        .btn-generate:disabled { background: #CBD5E0; cursor: not-allowed; box-shadow: none; transform: none; opacity: 0.7; }
        
        .loading-spinner { display: none; width: 20px; height: 20px; border: 3px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: white; animation: spin 1s linear infinite; }

        /* --- 5. RESULTADOS --- */
        #result-area { display: none; margin-top: 60px; scroll-margin-top: 40px; }
        
        .result-intro { text-align: center; margin-bottom: 40px; }
        .result-title { font-size: 2.2rem; color: var(--secondary); margin-bottom: 10px; }
        .typewriter-text { color: var(--primary); font-weight: 600; font-size: 1.1rem; min-height: 1.6em; }

        /* Tabs */
        .tabs-container { display: flex; justify-content: center; gap: 15px; margin-bottom: 40px; }
        .tab-btn {
            background: transparent;
            border: 2px solid transparent;
            padding: 12px 30px;
            border-radius: 30px;
            font-weight: 600;
            color: #A0AEC0;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1rem;
        }
        .tab-btn.active { background: var(--white); color: var(--primary); box-shadow: var(--shadow-md); border-color: var(--primary-light); }
        .tab-btn:hover:not(.active) { color: var(--primary); background: rgba(233, 30, 99, 0.05); }

        /* Cards de Produto Resultante */
        .routine-grid { display: grid; gap: 25px; }
        .product-result-card {
            background: var(--white);
            border-radius: var(--radius);
            padding: 25px;
            display: flex;
            gap: 25px;
            align-items: flex-start;
            border: 1px solid var(--border);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        .product-result-card::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 6px; background: #CCC; }
        
        /* Cores Din√¢micas da Borda Lateral */
        .cat-limpeza::before { background: var(--cat-limpeza); }
        .cat-tonico::before { background: var(--cat-tonico); }
        .cat-antiox::before { background: var(--cat-antiox); }
        .cat-acido::before { background: var(--cat-acido); }
        .cat-hidra::before { background: var(--cat-hidra); }
        .cat-fps::before { background: var(--cat-fps); }

        .product-result-card:hover { transform: translateX(10px); box-shadow: var(--shadow-md); }

        .prod-img-box {
            width: 100px;
            height: 100px;
            flex-shrink: 0;
            background: #fff;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 5px;
            overflow: hidden;
            border: 1px solid #eee;
        }
        .prod-img-box img { 
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
        }
        
        .prod-content { flex: 1; }
        .step-tag { display: inline-block; padding: 4px 10px; border-radius: 6px; font-size: 0.75rem; font-weight: 800; text-transform: uppercase; margin-bottom: 8px; letter-spacing: 0.5px; }
        .step-tag.morning { background: #FFF9C4; color: #FBC02D; }
        .step-tag.night { background: #E1BEE7; color: #8E24AA; }

        .prod-name { font-size: 1.3rem; margin-bottom: 5px; color: var(--secondary); }
        .prod-reason { color: var(--text-body); font-size: 0.95rem; margin-bottom: 15px; }
        
        .usage-instructions { 
            background: #F7FAFC; 
            padding: 15px; 
            border-radius: 8px; 
            border-left: 3px solid #CBD5E0; 
            font-size: 0.9rem; 
            color: #4A5568; 
            margin-bottom: 15px; 
            display: flex; 
            gap: 12px; 
            align-items: flex-start;
            line-height: 1.5;
        }
        
        .btn-buy { text-decoration: none; color: var(--white); background: var(--secondary); padding: 10px 20px; border-radius: 6px; font-size: 0.9rem; font-weight: 600; display: inline-flex; align-items: center; gap: 8px; transition: var(--transition); }
        .btn-buy:hover { background: var(--primary); }

        /* --- 6. POPUP --- */
        .popup-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 999;
            display: flex; align-items: center; justify-content: center;
            opacity: 0; pointer-events: none; transition: var(--transition);
            backdrop-filter: blur(5px);
        }
        .popup-overlay.active { opacity: 1; pointer-events: all; }
        
        .coupon-card {
            background: var(--white); width: 90%; max-width: 350px;
            padding: 30px; border-radius: 20px; text-align: center;
            transform: translateY(50px); transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
        }
        .popup-overlay.active .coupon-card { transform: translateY(0); }
        .close-btn { position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #A0AEC0; }
        
        .coupon-box {
            background: var(--primary-light); border: 2px dashed var(--primary);
            color: var(--primary); padding: 15px; font-family: monospace;
            font-size: 1.4rem; font-weight: 800; margin: 20px 0; cursor: pointer;
            position: relative;
        }
        .coupon-box:active { transform: scale(0.98); }
        .copy-feedback { font-size: 0.7rem; display: block; margin-top: 5px; opacity: 0; transition: 0.2s; }
        .copy-feedback.show { opacity: 1; }

        /* Anima√ß√µes Keyframes */
        @keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* --- RESPONSIVIDADE --- */
        @media (max-width: 600px) {
            .options-grid { grid-template-columns: 1fr 1fr; gap: 10px; }
            .option-card { padding: 15px 10px; }
            .option-icon { font-size: 2rem; margin-bottom: 10px; }
            .product-result-card { flex-direction: column; text-align: center; align-items: center; }
            .product-result-card::before { width: 100%; height: 6px; top: 0; bottom: auto; }
            .usage-instructions { text-align: left; }
            .prod-img-box { margin: 0 auto; }
            .brand { font-size: 2.2rem; }
            .section-title { font-size: 1.1rem; }
        }
    </style>
</head>
<body>

    <div class="container progress-container">
        <div class="progress-text">
            <span>Question√°rio</span>
            <span id="progress-steps">0/3 Respondido</span>
        </div>
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>
    </div>

    <header>
        <div class="brand">creamy</div>
        <p class="subtitle">Algoritmo de Rotina Personalizada</p>
    </header>

    <div class="container">
        
        <div class="question-section" style="animation-delay: 0.1s" id="sec-1">
            <div class="section-header">
                <div class="section-icon"><i class="ph ph-face-mask"></i></div>
                <h2 class="section-title">Qual seu tipo de pele?</h2>
            </div>
            <div class="options-grid">
                <label>
                    <input type="radio" name="skinType" value="normal" class="option-input" onchange="updateProgress()">
                    <div class="option-card">
                        <i class="ph ph-smiley option-icon"></i>
                        <span class="option-label">Equilibrada</span>
                        <i class="ph ph-check-circle check-badge"></i>
                    </div>
                </label>
                <label>
                    <input type="radio" name="skinType" value="oleosa" class="option-input" onchange="updateProgress()">
                    <div class="option-card">
                        <i class="ph ph-drop option-icon"></i>
                        <span class="option-label">Oleosa</span>
                        <i class="ph ph-check-circle check-badge"></i>
                    </div>
                </label>
                <label>
                    <input type="radio" name="skinType" value="seca" class="option-input" onchange="updateProgress()">
                    <div class="option-card">
                        <i class="ph ph-cactus option-icon"></i>
                        <span class="option-label">Seca</span>
                        <i class="ph ph-check-circle check-badge"></i>
                    </div>
                </label>
                <label>
                    <input type="radio" name="skinType" value="mista" class="option-input" onchange="updateProgress()">
                    <div class="option-card">
                        <i class="ph ph-scales option-icon"></i>
                        <span class="option-label">Mista</span>
                        <i class="ph ph-check-circle check-badge"></i>
                    </div>
                </label>
            </div>
        </div>

        <div class="question-section" style="animation-delay: 0.2s" id="sec-2">
            <div class="section-header">
                <div class="section-icon"><i class="ph ph-target"></i></div>
                <h2 class="section-title">Objetivos (Selecione todos que aplicar)</h2>
            </div>
            <div class="options-grid">
                <label>
                    <input type="checkbox" name="goal" value="acne" class="option-input" onchange="updateProgress()">
                    <div class="option-card">
                        <i class="ph ph-virus option-icon"></i>
                        <span class="option-label">Acne & Espinhas</span>
                        <i class="ph ph-check-circle check-badge"></i>
                    </div>
                </label>
                <label>
                    <input type="checkbox" name="goal" value="manchas" class="option-input" onchange="updateProgress()">
                    <div class="option-card">
                        <i class="ph ph-sun-dim option-icon"></i>
                        <span class="option-label">Manchas</span>
                        <i class="ph ph-check-circle check-badge"></i>
                    </div>
                </label>
                <label>
                    <input type="checkbox" name="goal" value="antienvelhecimento" class="option-input" onchange="updateProgress()">
                    <div class="option-card">
                        <i class="ph ph-hourglass option-icon"></i>
                        <span class="option-label">Anti-idade</span>
                        <i class="ph ph-check-circle check-badge"></i>
                    </div>
                </label>
                <label>
                    <input type="checkbox" name="goal" value="textura" class="option-input" onchange="updateProgress()">
                    <div class="option-card">
                        <i class="ph ph-sparkle option-icon"></i>
                        <span class="option-label">Poros & Textura</span>
                        <i class="ph ph-check-circle check-badge"></i>
                    </div>
                </label>
            </div>
        </div>

        <div class="question-section" style="animation-delay: 0.3s" id="sec-3">
            <div class="section-header">
                <div class="section-icon"><i class="ph ph-flask"></i></div>
                <h2 class="section-title">Experi√™ncia com Skincare</h2>
            </div>
            <div class="options-grid">
                <label>
                    <input type="radio" name="level" value="iniciante" class="option-input" onchange="updateProgress()">
                    <div class="option-card">
                        <i class="ph ph-baby option-icon"></i>
                        <span class="option-label">Iniciante</span>
                        <i class="ph ph-check-circle check-badge"></i>
                    </div>
                </label>
                <label>
                    <input type="radio" name="level" value="intermediario" class="option-input" onchange="updateProgress()">
                    <div class="option-card">
                        <i class="ph ph-student option-icon"></i>
                        <span class="option-label">J√° uso algo</span>
                        <i class="ph ph-check-circle check-badge"></i>
                    </div>
                </label>
                <label>
                    <input type="radio" name="level" value="avancado" class="option-input" onchange="updateProgress()">
                    <div class="option-card">
                        <i class="ph ph-graduation-cap option-icon"></i>
                        <span class="option-label">Expert (Hardcore)</span>
                        <i class="ph ph-check-circle check-badge"></i>
                    </div>
                </label>
            </div>
        </div>

        <div class="action-area">
            <button id="btn-calc" class="btn-generate" onclick="generateRoutine()" disabled>
                <span class="btn-text">Gerar Minha Rotina</span>
                <div class="loading-spinner"></div>
                <i class="ph ph-arrow-right icon-arrow"></i>
            </button>
            <p style="margin-top: 10px; font-size: 0.85rem; color: #A0AEC0;">
                <i class="ph ph-lock-key"></i> Dados seguros e processados no seu dispositivo.
            </p>
        </div>

        <div id="result-area">
            <div class="result-intro">
                <h3 class="result-title">Sua Estrat√©gia Creamy</h3>
                <div id="typewriter" class="typewriter-text"></div>
            </div>

            <div class="tabs-container">
                <button class="tab-btn active" onclick="switchTab('morning', this)">üåû Rotina Diurna</button>
                <button class="tab-btn" onclick="switchTab('night', this)">üåô Rotina Noturna</button>
            </div>

            <div id="content-morning" class="routine-grid" style="display: grid;"></div>
            <div id="content-night" class="routine-grid" style="display: none;"></div>
        </div>

    </div>

    <div id="popupOverlay" class="popup-overlay">
        <div class="coupon-card">
            <button class="close-btn" onclick="closePopup()">&times;</button>
            <div style="font-size: 3rem; margin-bottom: 10px;">üéÅ</div>
            <h3 style="color: var(--secondary); margin-bottom: 5px;">Gostou da rotina?</h3>
            <p style="color: var(--text-body); font-size: 0.9rem; margin-bottom: 15px;">Leve o kit completo com <strong>10% OFF</strong> agora.</p>
            
            <div class="coupon-box" onclick="copyCoupon()">
                CREAMY10
                <span class="copy-feedback" id="copyMsg">Copiado!</span>
            </div>
            <button onclick="closePopup()" style="background: var(--secondary); color: white; border: none; padding: 10px 20px; border-radius: 8px; width: 100%; cursor: pointer;">Fechar</button>
        </div>
    </div>

<script>
    // --- 1. DADOS DE PRODUTOS ---
    const products = [
        // Limpeza
        { 
            id: "gl", name: "Gel de Limpeza", cat: "Limpeza", 
            img: "https://creamy.vtexassets.com/arquivos/ids/157830-800-auto?v=638905143508700000&width=800&height=auto&aspect=true", 
            desc: "Limpeza eficiente para peles oleosas e mistas.", link: "https://www.creamy.com.br/gel-de-limpeza/p" 
        },
        { 
            id: "el", name: "Emuls√£o de Limpeza", cat: "Limpeza", 
            img: "https://creamy.vtexassets.com/arquivos/ids/157995-800-auto?v=638902570356770000&width=800&height=auto&aspect=true", 
            desc: "Limpeza cremosa e hidratante.", link: "https://www.creamy.com.br/emulsao-de-limpeza/p" 
        },
        { 
            id: "lg", name: "Limpador Glicerinado", cat: "Limpeza", 
            img: "https://creamy.vtexassets.com/arquivos/ids/157835-800-auto?v=638901986008330000&width=800&height=auto&aspect=true", 
            desc: "Cl√°ssico suave neutro.", link: "https://www.creamy.com.br/limpador-facial-glicerinado/p" 
        },
        // T√¥nicos
        { 
            id: "t_tranex", name: "T√¥nico √Åc. Tranex√¢mico", cat: "T√¥nico", 
            img: "https://creamy.vtexassets.com/arquivos/ids/158013-800-auto?v=638902579799130000&width=800&height=auto&aspect=true", 
            desc: "Solu√ß√£o clareadora e uniformizadora.", link: "https://www.creamy.com.br/acido-tranexamico-5478624/p" 
        },
        { 
            id: "t_salic", name: "T√¥nico √Åc. Salic√≠lico", cat: "T√¥nico", 
            img: "https://creamy.vtexassets.com/arquivos/ids/157775-800-auto?v=638901975006200000&width=800&height=auto&aspect=true", 
            desc: "Reduz poros e oleosidade imediata.", link: "https://www.creamy.com.br/acido-salicilico/p" 
        },
        // Antioxidantes
        { 
            id: "vitc", name: "Vitamina C 10%", cat: "Antioxidante", 
            img: "https://creamy.vtexassets.com/arquivos/ids/158047-800-auto?v=638902591541030000&width=800&height=auto&aspect=true", 
            desc: "Glow instant√¢neo e prote√ß√£o urbana.", link: "https://www.creamy.com.br/vitamina-c/p" 
        },
        { 
            id: "vitc_gold", name: "Vitamina C Gold", cat: "Antioxidante", 
            img: "https://creamy.vtexassets.com/arquivos/ids/157878-800-auto?v=638949372154800000&width=800&height=auto&aspect=true", 
            desc: "Tecnologia avan√ßada para peles maduras.", link: "https://www.creamy.com.br/vitamina-c-gold/p" 
        },
        { 
            id: "niac", name: "Niacinamide 20%", cat: "Tratamento", 
            img: "https://creamy.vtexassets.com/arquivos/ids/157793-800-auto?v=638901978865330000&width=800&height=auto&aspect=true", 
            desc: "Blend potente para poros e textura.", link: "https://www.creamy.com.br/niacinamide-b-complex/p" 
        },
        // √Åcidos
        { 
            id: "mandelico", name: "√Åcido Mand√©lico", cat: "Renovador", 
            img: "https://creamy.vtexassets.com/arquivos/ids/157961-800-auto?v=638902526406700000&width=800&height=auto&aspect=true", 
            desc: "O melhor amigo contra manchas e acne.", link: "https://www.creamy.com.br/acido-mandelico/p" 
        },
        { 
            id: "glicolico", name: "√Åcido Glic√≥lico", cat: "Renovador Potente", 
            img: "https://creamy.vtexassets.com/arquivos/ids/158007-800-auto?v=638902579335770000&width=800&height=auto&aspect=true", 
            desc: "Renova√ß√£o celular intensa.", link: "https://www.creamy.com.br/acido-glicolico/p" 
        },
        { 
            id: "lactic", name: "√Åcido L√°tico", cat: "Renovador Hidratante", 
            img: "https://creamy.vtexassets.com/arquivos/ids/157766-800-auto?v=638901971806870000&width=800&height=auto&aspect=true", 
            desc: "Esfolia√ß√£o qu√≠mica para peles sens√≠veis.", link: "https://www.creamy.com.br/acido-latico/p" 
        },
        { 
            id: "retinol", name: "Retinol 0.3", cat: "Anti-idade", 
            img: "https://creamy.vtexassets.com/arquivos/ids/158043-800-auto?v=638902590999200000&width=800&height=auto&aspect=true", 
            desc: "O padr√£o ouro contra rugas finas.", link: "https://www.creamy.com.br/retinol/p" 
        },
        { 
            id: "retinal", name: "Retinal", cat: "Anti-idade Potente", 
            img: "https://creamy.vtexassets.com/arquivos/ids/158038-800-auto?v=638902590812670000&width=800&height=auto&aspect=true", 
            desc: "A evolu√ß√£o do retinol: mais r√°pido e antibacteriano.", link: "https://www.creamy.com.br/serum-facial-anti-aging-retinal-30-g/p" 
        },
        // Hidrata√ß√£o
        { 
            id: "calming", name: "Calming Cream", cat: "Hidratante", 
            img: "https://creamy.vtexassets.com/arquivos/ids/157983-800-auto?v=638902569437500000&width=800&height=auto&aspect=true", 
            desc: "Al√≠vio imediato para vermelhid√£o.", link: "https://www.creamy.com.br/creamy-calming-cream/p" 
        },
        { 
            id: "intensive", name: "Intensive Repair", cat: "Hidratante", 
            img: "https://creamy.vtexassets.com/arquivos/ids/157843-800-auto?v=638901987089200000&width=800&height=auto&aspect=true", 
            desc: "Repara√ß√£o profunda da barreira.", link: "https://www.creamy.com.br/intensive-repair-cream/p" 
        },
        { 
            id: "serum_hid", name: "S√©rum Hidratante", cat: "Hidratante", 
            img: "https://creamy.vtexassets.com/arquivos/ids/158030-800-auto?v=638902590530770000&width=800&height=auto&aspect=true", 
            desc: "Hidrata√ß√£o invis√≠vel com √Åcido Hialur√¥nico.", link: "https://www.creamy.com.br/drops-serum-hidratante/p" 
        },
        { 
            id: "eye", name: "Eye Cream", cat: "Olhos", 
            img: "https://creamy.vtexassets.com/arquivos/ids/157883-800-auto?v=638901992983700000&width=800&height=auto&aspect=true", 
            desc: "Tratamento 360¬∫ para o olhar.", link: "https://www.creamy.com.br/eye-cream/p" 
        },
        // Prote√ß√£o
        { 
            id: "fps", name: "Protetor Solar Watery Fluid FPS 50", cat: "Prote√ß√£o", 
            img: "https://creamy.vtexassets.com/arquivos/ids/158163-800-auto?v=638989989648000000&width=800&height=auto&aspect=true", 
            desc: "Toque seco, invis√≠vel e alta prote√ß√£o.", link: "https://www.creamy.com.br/protetor-solar-watery-fluid-fps-50/p" 
        }
    ];

    const catClasses = {
        "Limpeza": "cat-limpeza", "T√¥nico": "cat-tonico", "Antioxidante": "cat-antiox",
        "Tratamento": "cat-antiox", "Renovador": "cat-acido", "Renovador Potente": "cat-acido",
        "Renovador Hidratante": "cat-acido", "Anti-idade": "cat-acido", "Anti-idade Potente": "cat-acido",
        "Hidratante": "cat-hidra", "Prote√ß√£o": "cat-fps", "Olhos": "cat-hidra"
    };

    // --- 2. L√ìGICA DE UI (Progresso & Valida√ß√£o) ---
    function updateProgress() {
        const s1 = document.querySelector('input[name="skinType"]:checked');
        const s2 = document.querySelector('input[name="goal"]:checked');
        const s3 = document.querySelector('input[name="level"]:checked');

        let count = 0;
        if(s1) count++;
        if(s2) count++;
        if(s3) count++;

        // Atualizar Barra
        const percentage = (count / 3) * 100;
        document.getElementById('progress-fill').style.width = percentage + '%';
        document.getElementById('progress-steps').innerText = `${count}/3 Respondido`;

        // Habilitar Bot√£o
        const btn = document.getElementById('btn-calc');
        btn.disabled = (count < 3);
    }

    // --- 3. L√ìGICA DE GERA√á√ÉO (Core) ---
    function generateRoutine() {
        const btn = document.getElementById('btn-calc');
        const spinner = btn.querySelector('.loading-spinner');
        const icon = btn.querySelector('.icon-arrow');
        const text = btn.querySelector('.btn-text');
        
        // Estado de Loading
        btn.disabled = true;
        spinner.style.display = 'inline-block';
        icon.style.display = 'none';
        text.innerText = 'Analisando Pele...';

        // Simula√ß√£o de delay para "pensar" (UX Premium)
        setTimeout(() => {
            const skinType = getVal('skinType');
            const goals = getCheckboxVal('goal');
            const level = getVal('level');

            calculateLogic(skinType, goals, level);
            
            // UI Feedback Final
            text.innerText = 'Gerar Novamente';
            spinner.style.display = 'none';
            icon.style.display = 'inline-block';
            btn.disabled = false;

            // Mostrar e Scroll
            const resultArea = document.getElementById('result-area');
            resultArea.style.display = 'block';
            resultArea.scrollIntoView({ behavior: 'smooth', block: 'start' });

            // Efeito de digita√ß√£o da frase
            typeWriterEffect(skinType, goals);

            // Trigger do Popup ap√≥s 5 segundos da gera√ß√£o
            setTimeout(() => {
                document.getElementById('popupOverlay').classList.add('active');
            }, 5000);

        }, 1500);
    }

    function calculateLogic(skinType, goals, level) {
        let morning = [];
        let night = [];

        // Helper
        const add = (list, id, stepName, reason) => {
            const p = products.find(x => x.id === id);
            if(p) list.push({ p, stepName, reason, usage: getUsageText(p, level) });
        }

        // 1. Limpeza
        let cl = (skinType === 'seca' || skinType === 'sensivel') ? 'el' : (skinType === 'oleosa' ? 'gl' : 'lg');
        add(morning, cl, 'Limpeza', 'Remover oleosidade noturna.');
        add(night, cl, 'Limpeza', 'Remover polui√ß√£o e impurezas.');

        // 2. Olhos (Se necess√°rio)
        if (goals.includes('antienvelhecimento') || goals.includes('manchas')) {
            add(morning, 'eye', 'Olhos', 'Hidrata√ß√£o da √°rea sens√≠vel.');
            add(night, 'eye', 'Olhos', 'Tratamento de linhas finas.');
        }

        // 3. Ativos Manh√£
        if (goals.includes('acne') && (skinType === 'oleosa' || skinType === 'mista')) add(morning, 't_salic', 'T√¥nico', 'Controle de poros.');
        else if (goals.includes('manchas')) add(morning, 't_tranex', 'T√¥nico', 'Inibi√ß√£o de pigmento.');

        let dayActive = (skinType === 'oleosa' && goals.includes('acne')) ? 'niac' : (goals.includes('antienvelhecimento') ? 'vitc_gold' : 'vitc');
        add(morning, dayActive, 'Tratamento', 'Antioxidante e luminosidade.');

        // 4. Ativos Noite (L√≥gica Complexa Simplificada)
        let nightActive = 'mandelico'; // Default seguro
        if (skinType === 'sensivel') nightActive = 'lactic';
        else if (goals.includes('acne') && goals.includes('antienvelhecimento')) nightActive = 'retinal';
        else if (goals.includes('acne')) nightActive = (level === 'iniciante') ? 'mandelico' : 'retinal';
        else if (goals.includes('antienvelhecimento')) nightActive = (level === 'avancado') ? 'retinal' : 'retinol';
        else if (goals.includes('textura')) nightActive = 'glicolico';

        add(night, nightActive, 'Ativo Principal', 'Tratamento profundo.');

        // 5. Hidrata√ß√£o
        let hidra = (skinType === 'oleosa') ? 'serum_hid' : (skinType === 'seca' ? 'intensive' : 'calming');
        if(skinType !== 'oleosa') add(morning, hidra, 'Hidrata√ß√£o', 'Proteger barreira.');
        add(night, hidra, 'Hidrata√ß√£o', 'Recupera√ß√£o noturna.');

        // 6. Prote√ß√£o
        add(morning, 'fps', 'Prote√ß√£o', 'Passo mais importante do dia.');

        renderList('content-morning', morning, 'morning');
        renderList('content-night', night, 'night');
    }

    // --- 4. RENDERIZA√á√ÉO ---
    function renderList(divId, list, type) {
        const container = document.getElementById(divId);
        container.innerHTML = '';
        
        list.forEach((item, index) => {
            const colorClass = catClasses[item.p.cat] || 'cat-acido';
            const badgeClass = type;
            
            // Aqui est√° o "animation: fadeUp" inicial. O switchTab precisa respeitar isso.
            const html = `
                <div class="product-result-card ${colorClass}" style="animation: fadeUp 0.5s ease forwards; animation-delay: ${index * 0.1}s; opacity: 0;">
                    <div class="prod-img-box">
                        <img src="${item.p.img}" alt="${item.p.name}">
                    </div>
                    <div class="prod-content">
                        <span class="step-tag ${badgeClass}">Passo ${index + 1} ‚Ä¢ ${item.stepName}</span>
                        <h4 class="prod-name">${item.p.name}</h4>
                        <p class="prod-reason">${item.reason}</p>
                        
                        <div class="usage-instructions">
                            <i class="ph ph-info" style="font-size: 1.5rem; color: var(--primary); flex-shrink: 0; margin-top: 3px;"></i>
                            <div>
                                <strong style="display:block; margin-bottom:5px;">Como usar:</strong>
                                ${item.usage}
                            </div>
                        </div>

                        <a href="${item.p.link}" target="_blank" class="btn-buy">
                            Comprar <i class="ph ph-arrow-square-out"></i>
                        </a>
                    </div>
                </div>
            `;
            container.innerHTML += html;
        });
    }

    // --- 5. HELPERS E L√ìGICA DE FREQU√äNCIA MELHORADA ---
    function getVal(n) { const el = document.querySelector(`input[name="${n}"]:checked`); return el ? el.value : null; }
    function getCheckboxVal(n) { return Array.from(document.querySelectorAll(`input[name="${n}"]:checked`)).map(c => c.value); }

    function getUsageText(prod, level) {
        // 1. LIMPEZA
        if(prod.cat === 'Limpeza') {
            return "<strong>Manh√£ e Noite:</strong> Aplique sobre a pele √∫mida, massageie suavemente por 60 segundos e enx√°gue. N√£o use √°gua quente.";
        }

        // 2. T√îNICOS
        if(prod.cat === 'T√¥nico') {
            if(prod.id === 't_salic' || prod.id === 't_tranex') {
                if(level === 'iniciante') return "<strong>Noite:</strong> Inicie usando 3x na semana ap√≥s a limpeza. Aplique com as m√£os ou algod√£o. Aumente se a pele tolerar bem.";
                return "<strong>Manh√£ ou Noite:</strong> Pode ser usado diariamente ap√≥s limpar o rosto. Espere secar antes do pr√≥ximo passo.";
            }
            return "Use diariamente ap√≥s a limpeza para equilibrar o pH.";
        }

        // 3. ANTIOXIDANTES (Vit C, Niacinamida)
        if(prod.cat === 'Antioxidante' || prod.cat === 'Tratamento') {
            if(prod.id === 'vitc' || prod.id === 'vitc_gold') {
                return "<strong>Pela manh√£:</strong> Com o rosto limpo e seco, seja o primeiro produto a aplicar. 3 a 5 gotas s√£o suficientes.";
            }
            if(prod.id === 'niac') {
                return "<strong>Manh√£ e/ou Noite:</strong> Pode ser usado antes do hidratante. Ajuda a controlar a oleosidade durante o dia.";
            }
        }

        // 4. √ÅCIDOS E RENOVADORES (Escadinha de Toler√¢ncia)
        if(prod.cat.includes('Renovador') || prod.cat.includes('Anti-idade')) {
            const warning = "<br><em style='font-size:0.85em; color:#E91E63; display:block; margin-top:5px;'>*Evite aplicar nos cantos do nariz, boca e olhos.</em>";
            
            if(level === 'iniciante') {
                return "<strong>Apenas √† noite.</strong> Comece devagar: Use 2 noites na semana (ex: Ter√ßa e Sexta). Aumente conforme toler√¢ncia." + warning;
            }
            if(level === 'intermediario') {
                return "<strong>Apenas √† noite.</strong> Use em noites alternadas (Dia sim, dia n√£o). Se sentir sensibilidade, d√™ um intervalo maior." + warning;
            }
            // Avan√ßado
            return "<strong>Uso Noturno Di√°rio.</strong> Aplique uma fina camada. Suspenda o uso caso a pele fique sensibilizada." + warning;
        }

        // 5. HIDRATANTES
        if(prod.cat === 'Hidratante') {
            if(prod.id === 'calming') return "Use sempre que sentir a pele sens√≠vel ou vermelha. Ideal aplicar <strong>antes</strong> dos √°cidos fortes para reduzir irrita√ß√£o.";
            return "<strong>Manh√£ e Noite:</strong> Aplique em todo o rosto. De dia, uma camada fina. √Ä noite, uma camada generosa para recuperar a pele.";
        }

        // 6. √ÅREA DOS OLHOS
        if(prod.cat === 'Olhos') {
            return "Aplique uma quantidade pequena (gr√£o de arroz) e espalhe com o dedo anelar dando leves batidinhas. N√£o esfregue.";
        }

        // 7. PROTE√á√ÉO SOLAR
        if(prod.cat === 'Prote√ß√£o') {
            return "<strong>Uso Obrigat√≥rio:</strong> Aplique a regra dos 3 dedos para rosto e pesco√ßo. Reaplique ap√≥s o almo√ßo ou se suar muito.";
        }

        return "Siga as instru√ß√µes do r√≥tulo.";
    }

    function typeWriterEffect(skinType, goals) {
        const el = document.getElementById('typewriter');
        el.innerHTML = '';
        
        // Frase din√¢mica baseada no objetivo
        let phrase = `Para sua pele ${skinType}, focamos em equil√≠brio.`;
        if(goals.includes('acne')) phrase = `Montamos um escudo contra a acne para sua pele ${skinType}.`;
        if(goals.includes('antienvelhecimento')) phrase = `Uma rotina de alta performance para renovar sua pele ${skinType}.`;
        
        let i = 0;
        const speed = 30;
        function type() {
            if (i < phrase.length) {
                el.innerHTML += phrase.charAt(i);
                i++;
                setTimeout(type, speed);
            }
        }
        type();
    }

    // --- FUN√á√ÉO CORRIGIDA PARA AS ABAS FUNCIONAREM ---
    function switchTab(tab, btn) {
        // 1. Atualiza classes dos bot√µes (Visual)
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        
        // Verifica se o bot√£o foi passado (para funcionar no clique)
        if (btn) {
            btn.classList.add('active');
        }

        // 2. Esconde ambas as listas
        document.getElementById('content-morning').style.display = 'none';
        document.getElementById('content-night').style.display = 'none';
        
        // 3. Mostra a lista alvo
        const target = document.getElementById(`content-${tab}`);
        target.style.display = 'grid';
        
        // 4. Reinicia a anima√ß√£o corretamente
        target.querySelectorAll('.product-result-card').forEach(c => {
            // Guarda o delay original (para manter o efeito escadinha)
            const currentDelay = c.style.animationDelay;

            // Reseta a anima√ß√£o
            c.style.animation = 'none';
            c.offsetHeight; /* For√ßa o navegador a recalcular (Reflow) */
            
            // Reaplica a anima√ß√£o explicitamente
            c.style.animation = 'fadeUp 0.5s ease forwards';
            c.style.animationDelay = currentDelay; // Devolve o delay
        });
    }

    // Popup Logic
    function closePopup() { document.getElementById('popupOverlay').classList.remove('active'); }
    function copyCoupon() {
        const text = "CREAMY10";
        if (navigator.clipboard && window.isSecureContext) {
            navigator.clipboard.writeText(text);
        } else {
            let textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
        }
        
        const msg = document.getElementById('copyMsg');
        msg.classList.add('show');
        setTimeout(() => msg.classList.remove('show'), 2000);
    }
</script>
</body>
</html>
